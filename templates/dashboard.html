{% extends "base.html" %}
{% block content %}
<div class="flex justify-between items-end mb-8">
    <div>
        <h1 class="text-3xl font-bold text-gray-900">Procurement Dashboard</h1>
        <p class="text-gray-500 mt-1">Manage vendor onboarding requests and approvals.</p>
    </div>
    {% if current_user.role == 'initiator' %}
        <button onclick="document.getElementById('newReqModal').classList.remove('hidden')" 
                class="bg-green-600 text-white px-5 py-2.5 rounded-lg hover:bg-green-700 shadow-md font-bold flex items-center transition">
            <span class="text-xl mr-2">+</span> Initiate Onboarding
        </button>
    {% endif %}
</div>

<div class="bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden">
    <table class="min-w-full divide-y divide-gray-200">
        <thead class="bg-gray-50">
            <tr>
                <th class="px-6 py-4 text-left text-xs font-bold text-gray-500 uppercase tracking-wider">Request ID</th>
                <th class="px-6 py-4 text-left text-xs font-bold text-gray-500 uppercase tracking-wider">Vendor Name</th>
                <th class="px-6 py-4 text-left text-xs font-bold text-gray-500 uppercase tracking-wider">Type</th>
                <th class="px-6 py-4 text-left text-xs font-bold text-gray-500 uppercase tracking-wider">Status</th>
                <th class="px-6 py-4 text-left text-xs font-bold text-gray-500 uppercase tracking-wider">Date</th>
                <th class="px-6 py-4 text-right text-xs font-bold text-gray-500 uppercase tracking-wider">Action</th>
            </tr>
        </thead>
        <tbody class="bg-white divide-y divide-gray-200">
            {% for req in requests %}
            <tr class="hover:bg-gray-50 transition">
                <td class="px-6 py-4 whitespace-nowrap text-sm font-mono text-gray-500">{{ req.request_id }}</td>
                <td class="px-6 py-4 whitespace-nowrap">
                    <div class="text-sm font-bold text-gray-900">{{ req.vendor_name_basic }}</div>
                    <div class="text-xs text-gray-500">{{ req.vendor_email }}</div>
                </td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-600">{{ req.vendor_type }}</td>
                <td class="px-6 py-4 whitespace-nowrap">
                    {% if req.status == 'COMPLETED' %}
                        <span class="px-3 py-1 inline-flex text-xs leading-5 font-bold rounded-full bg-green-100 text-green-800 border border-green-200">
                            Active
                        </span>
                    {% elif req.status == 'REJECTED' %}
                        <span class="px-3 py-1 inline-flex text-xs leading-5 font-bold rounded-full bg-red-100 text-red-800 border border-red-200">
                            Rejected
                        </span>
                    {% else %}
                        <span class="px-3 py-1 inline-flex text-xs leading-5 font-bold rounded-full bg-orange-100 text-orange-800 border border-orange-200">
                            {{ req.status.replace('_', ' ') }}
                        </span>
                    {% endif %}
                </td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                    {{ req.created_at.strftime('%d %b, %Y') }}
                </td>
                <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                    <a href="{{ url_for('review_request', req_id=req.id) }}" class="text-green-600 hover:text-green-900 font-bold hover:underline">View Details</a>
                </td>
            </tr>
            {% else %}
            <tr>
                <td colspan="6" class="px-6 py-10 text-center text-sm text-gray-500">
                    No requests found. Start by adding a new vendor.
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<div id="newReqModal" class="fixed z-50 inset-0 overflow-y-auto hidden" aria-labelledby="modal-title" role="dialog" aria-modal="true">
    <div class="flex items-end justify-center min-h-screen pt-4 px-4 pb-20 text-center sm:block sm:p-0">
        <div class="fixed inset-0 bg-gray-900 bg-opacity-75 transition-opacity" aria-hidden="true" onclick="document.getElementById('newReqModal').classList.add('hidden')"></div>
        <div class="inline-block align-bottom bg-white rounded-lg text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-lg sm:w-full">
            <div class="bg-green-700 px-6 py-4">
                <h3 class="text-lg leading-6 font-bold text-white" id="modal-title">Initiate New Vendor</h3>
            </div>
            <form action="{{ url_for('create_request') }}" method="POST" class="p-6">
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Vendor Name</label>
                        <input type="text" name="vendor_name" required class="w-full border-gray-300 rounded-md shadow-sm border p-2 focus:ring-green-500 focus:border-green-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Email Address</label>
                        <input type="email" name="vendor_email" required class="w-full border-gray-300 rounded-md shadow-sm border p-2 focus:ring-green-500 focus:border-green-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Vendor Category</label>
                        <select name="vendor_type" class="w-full border-gray-300 rounded-md shadow-sm border p-2 focus:ring-green-500 focus:border-green-500">
                            <option value="Raw Material">Raw Material Supply</option>
                            <option value="Packaging">Packaging Material</option>
                            <option value="Services">Logistics / Services</option>
                            <option value="Maintenance">Maintenance / IT</option>
                        </select>
                    </div>
                </div>
                <div class="mt-6 flex justify-end space-x-3">
                    <button type="button" onclick="document.getElementById('newReqModal').classList.add('hidden')" class="bg-white py-2 px-4 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 hover:bg-gray-50">
                        Cancel
                    </button>
                    <button type="submit" class="bg-green-600 py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white hover:bg-green-700">
                        Send Invite
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}