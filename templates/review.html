{% extends "base.html" %}
{% block content %}
<div class="max-w-7xl mx-auto">
    
    <div class="flex justify-between items-center mb-8">
        <div>
            <h1 class="text-3xl font-bold text-gray-900">Review Application</h1>
            <p class="text-gray-500 mt-1">Request ID: <span class="font-mono font-bold">{{ req.request_id }}</span></p>
        </div>
        <div class="text-right">
            <span class="block text-xs font-bold text-gray-400 uppercase tracking-wider">Current Status</span>
            <div class="flex items-center gap-2 mt-1">
                <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-bold bg-blue-100 text-blue-800">
                    {{ req.current_dept_flow.replace('_', ' ') }}
                </span>
            </div>
        </div>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
        
        <div class="lg:col-span-2 space-y-8">
            <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
                <h3 class="text-lg font-bold text-gray-800 mb-4 border-b pb-2">Vendor Profile</h3>
                <dl class="grid grid-cols-2 gap-x-4 gap-y-6 text-sm">
                    <div><dt class="text-xs font-bold text-gray-500 uppercase">Vendor Name</dt><dd>{{ req.vendor_name_basic }}</dd></div>
                    <div><dt class="text-xs font-bold text-gray-500 uppercase">Email</dt><dd>{{ req.vendor_email }}</dd></div>
                    <div><dt class="text-xs font-bold text-gray-500 uppercase">Address</dt>
                        <dd>{{ req.address_line1 }}, {{ req.address_city }} - {{ req.address_pincode }}</dd>
                    </div>
                    <div><dt class="text-xs font-bold text-gray-500 uppercase">Contact</dt>
                        <dd>{{ req.contact_name }} ({{ req.contact_number }})</dd>
                    </div>
                </dl>
            </div>

            <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-6">
                <h3 class="text-lg font-bold text-gray-800 mb-4 border-b pb-2">Documents</h3>
                <div class="space-y-3">
                    {% set docs = [(req.doc_gst, 'GST Cert'), (req.doc_pan, 'PAN Card'), (req.doc_cheque, 'Cheque'), (req.doc_msme, 'MSME Cert')] %}
                    {% for path, label in docs %}
                        {% if path %}
                        <div class="flex justify-between p-3 bg-gray-50 rounded border">
                            <span>ðŸ“„ {{ label }}</span>
                            <a href="{{ url_for('static', filename='uploads/' + path) }}" target="_blank" class="text-blue-600 font-bold text-xs">View â†—</a>
                        </div>
                        {% endif %}
                    {% endfor %}
                </div>
            </div>
        </div>

        <div class="col-span-1">
            {% if is_my_turn %}
                <div class="bg-white rounded-xl shadow-lg border-t-4 border-green-600 p-6 sticky top-24">
                    <h3 class="text-xl font-bold text-gray-900 mb-4">Take Action</h3>
                    <form method="POST" class="space-y-4">
                        
                        {% if req.current_dept_flow == 'INITIATOR_REVIEW' or req.finance_stage == 'TAX' %}
                        <div class="bg-blue-50 p-3 rounded border border-blue-100">
                            <label class="block text-xs font-bold text-blue-800 uppercase mb-1">Account Group</label>
                            <select name="account_group" class="w-full border p-2 rounded text-sm">
                                <option value="ZDOM" {% if req.account_group == 'ZDOM' %}selected{% endif %}>ZDOM (Domestic)</option>
                                <option value="ZIMP" {% if req.account_group == 'ZIMP' %}selected{% endif %}>ZIMP (Import)</option>
                            </select>
                        </div>
                        {% endif %}

                        {% if req.current_dept_flow == 'DEPT' %}
                        <div class="bg-yellow-50 p-4 rounded border border-yellow-200">
                            <h4 class="text-xs font-bold text-yellow-800 uppercase mb-3">Commercial Terms</h4>
                            <div class="space-y-3">
                                <div>
                                    <label class="block text-[10px] font-bold text-gray-500 uppercase">Payment Terms</label>
                                    <select name="payment_terms" class="w-full border rounded p-1.5 text-sm">
                                        <option value="">-- Select --</option>
                                        <option value="0001">Immediate</option>
                                        <option value="Z030">30 Days Credit</option>
                                        <option value="Z045">45 Days Credit</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-[10px] font-bold text-gray-500 uppercase">Incoterms</label>
                                    <select name="incoterms" class="w-full border rounded p-1.5 text-sm">
                                        <option value="">-- Select --</option>
                                        <option value="FOB">FOB</option>
                                        <option value="CIF">CIF</option>
                                        <option value="DAP">DAP</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-[10px] font-bold text-gray-500 uppercase">Purchase Org</label>
                                    <input type="text" name="purchase_org" placeholder="e.g. 1000" class="w-full border rounded p-1.5 text-sm">
                                </div>
                            </div>
                        </div>
                        {% endif %}

                        {% if req.current_dept_flow == 'IT' %}
                        <div class="bg-purple-50 p-4 rounded border border-purple-100">
                            <label class="block text-xs font-bold text-purple-800 uppercase mb-1">Create SAP Vendor Code</label>
                            <input type="text" name="sap_id" placeholder="e.g. 5001999" required class="w-full border p-2 rounded text-sm">
                        </div>
                        {% endif %}

                        <button name="action" value="approve" class="w-full bg-green-700 text-white font-bold py-3 rounded hover:bg-green-800">Approve</button>
                        <button name="action" value="reject" class="w-full bg-white text-red-600 font-bold py-3 rounded border border-red-200">Reject</button>
                    </form>
                </div>
            {% else %}
                <div class="bg-gray-50 rounded-xl border border-gray-200 p-6 text-center opacity-75">
                    <h3 class="text-lg font-bold text-gray-700">Pending Review</h3>
                    <p class="text-sm text-gray-500 mt-2">Currently with: {{ pending_email }}</p>
                </div>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}